---
interface Product {
  id: string;
  title: string;
  image: string;
  href: string;
  alt: string;
}

interface Props {
  products: Product[];
}

const { products } = Astro.props;
---

<!-- Preload para las primeras imágenes -->
{products.slice(0, 4).map((product) => (
  <link
    rel="preload"
    as="image"
    href={`${product.image}?w=288&q=80&f=webp`}
    media="(min-width: 768px)"
  />
))}

<!-- Contenedor principal del artículo -->
<div class="ArticleStrip">
    <!-- Sección de próximos lanzamientos -->
    <div class="ProxLanzWheel">
        <!-- Slider principal de Kodansha -->
        <section class="KITHSlider prox-lanzamientos-slider">
            <div class="KITHSlider-contentWrapper">
                <!-- Títulos del slider -->
                <h3>PROXIMOS LANZAMIENTOS</h3>
                <h2>No te lo pierdas</h2>
                
                <!-- Contenedor del slider -->
                <div class="KITHSlider-sliderWrapper">
                    <div class="Slider">
                        <!-- Contenedor de elementos deslizables -->
                        <div class="Slider-tape" style="transform: translateX(0px);">
                            {products.map((product, index) => (
                                <div class={`Slider-item ${index >= 4 ? 'Slider-item-hidden Slider-item-right' : ''}`}>
                                    <a class="KITHWheelItem" 
                                       aria-label={product.alt}
                                       href={product.href}>
                                        <div class="InnerBorder-Product">
                                            <div class="Item-Thumbnail-Product" aria-label={product.alt}>
                                                <div class="ui-product-poster-container ui-product-poster-container-hover" 
                                                     style="padding-top: 125%;">
                                                    <div class="ui-product-poster-container-2">
                                                        <div class="ui-product-poster-wrapper">
                                                            <picture>
                                                                <!-- Fuentes WebP optimizadas -->
                                                                <source type="image/webp" 
                                                                        srcset={`${product.image}?f=webp&w=145 145w, ${product.image}?f=webp&w=288 288w, ${product.image}?f=webp&w=405 405w`}
                                                                        sizes="(max-width: 991px) 145px, (max-width: 1199px) 288px, 405px">
                                                                
                                                                <!-- Fuentes JPEG como fallback -->
                                                                <source type="image/jpeg" 
                                                                        srcset={`${product.image}?f=jpeg&w=145 145w, ${product.image}?f=jpeg&w=288 288w, ${product.image}?f=jpeg&w=405 405w`}
                                                                        sizes="(max-width: 991px) 145px, (max-width: 1199px) 288px, 405px">
                                                                
                                                                <!-- Imagen principal -->
                                                                <img 
                                                                    fetchpriority={index < 4 ? 'high' : 'low'}
                                                                    loading={index < 4 ? 'eager' : 'lazy'} 
                                                                    class="ui-product-poster-image" 
                                                                    src={`${product.image}?w=288&q=80`}
                                                                    alt={product.alt} 
                                                                    width="288" 
                                                                    height="360"
                                                                    decoding="async">
                                                            </picture>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="TituloItem" aria-label={`title for ${product.title}`}>{product.title}</div>
                                    </a>
                                </div>
                            ))}
                        </div>
                        
                        <!-- Indicadores de páginas (bullets) -->
                        <div class="KITHSlider-bullets">
                            {Array.from({ length: Math.ceil(products.length / 4) }, (_, i) => (
                                <button type="button" class={i === 0 ? 'active' : ''} title={`Page ${i + 1}`}></button>
                            ))}
                        </div>
                        
                        <!-- Botón anterior del slider -->
                        <div class="KITHSlider-btnWrapper prev">
                            <button type="button" tabindex="-1">
                                <svg viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
                                    <title>Anterior</title>
                                    <path d="M69.8437,43.3876,33.8422,13.3863a6.0035,6.0035,0,0,0-7.6878,9.223l30.47,25.39-30.47,25.39a6.0035,6.0035,0,0,0,7.6878,9.2231L69.8437,52.6106a6.0091,6.0091,0,0,0,0-9.223Z"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Botón siguiente del slider -->
                        <div class="KITHSlider-btnWrapper next visible">
                            <button type="button" tabindex="-1">
                                <svg viewBox="0 0 96 96" xmlns="http://www.w3.org/2000/svg">
                                    <title>Siguiente</title>
                                    <path d="M69.8437,43.3876,33.8422,13.3863a6.0035,6.0035,0,0,0-7.6878,9.223l30.47,25.39-30.47,25.39a6.0035,6.0035,0,0,0,7.6878,9.2231L69.8437,52.6106a6.0091,6.0091,0,0,0,0-9.223Z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Enlace para ver el calendario completo -->
        <a href="/calendario">
            <div role="button" 
                 class="arrow-container" 
                 aria-label="View Release Schedule">
                <span class="arrow-btn with-arrow text-bold">
                    Calendario de lanzamientos
                </span>
                <div class="icon-wrapper">
                    <svg viewBox="0 0 34 34" 
                         xmlns="http://www.w3.org/2000/svg" 
                         fill="white" 
                         width="80" 
                         class="icon">
                        <path d="m15.496 0 15.939 15.939H0v2.122h31.435L15.495 34H18.5L34 18.5v-3.004L18.5 0h-3.004Z"></path>
                    </svg>
                </div>
            </div>
        </a>
    </div>
</div>

<script>
import { ProximosLanzamientosSlider } from './ProximosLanzamientosSlider';

document.addEventListener('DOMContentLoaded', () => {
    new ProximosLanzamientosSlider({
        itemsPerPage: 4,
        sliderSelector: '.prox-lanzamientos-slider .Slider-tape',
        itemSelector: '.prox-lanzamientos-slider .Slider-item',
        nextBtnSelector: '.prox-lanzamientos-slider .KITHSlider-btnWrapper.next button',
        prevBtnSelector: '.prox-lanzamientos-slider .KITHSlider-btnWrapper.prev button',
        bulletsSelector: '.prox-lanzamientos-slider .KITHSlider-bullets'
    });
});
</script>